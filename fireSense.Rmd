---
title: "fireSense"
author: "Jean Marchal"
date: "`r format(Sys.time(), '%B %Y')`"
output:
  html_document:
    keep_md: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE, results = "hold") ## TODO: use 'eval = TRUE'
```

# Overview

A landscape fire model sensitive to environmental changes (e.g. weather and land-cover).

# Usage

```{r module usage example, eval = FALSE}
Require(c("SpaDES.core", "SpaDES.tools"))

set.seed(1)

nx <- ny <- 100L
n <- nx * ny
r <- raster(nrows = ny, ncols = nx, xmn = -nx/2, xmx = nx/2, ymn = -ny/2, ymx = ny/2)

# Create a map ignition probabilities
ignitionProbRaster <- gaussMap(r, scale = 10, var = .0001, speedup = nx/5e2, inMemory = TRUE)

# Create a map of escape probabilities
escapeProbRaster <- gaussMap(r, scale = 50, var = .01, speedup = nx/5e2, inMemory = TRUE)

# Create a map of spread probabilities
spreadProbRaster <- gaussMap(r, scale = 300, var = .05, speedup = nx/5e2, inMemory = TRUE)

#outputDir <- file.path(tempdir(), "outputs")
times <- list(start = 1, end = 100, timeunit = "year")

modules <- list("fireSense")

# Pass objects found in the global environment to the simList environment
objects <- list(
  ignitionProbRaster = ignitionProbRaster,
  escapeProbRaster = escapeProbRaster,
  spreadProbRaster = spreadProbRaster
)

paths <- list(
  # cachePath = file.path(outputDir, "cache"),
  modulePath = ".."
  # inputPath = inputDir,
  # outputPath = outputDir
)

mySim <- simInit(times = times, params = parameters, modules = modules, objects = objects, paths = paths)

spades(mySim)
```

# Parameters

```{r moduleParams, echo = FALSE, eval = TRUE}
df_params <- SpaDES.core::moduleParams("fireSense", "..")
knitr::kable(df_params)
```

# Events

- ignite fires
- determine which fires escape
- spread escaped fires
- save
- plot

## Plotting

- **Burn map**: Pixels burned this timestep.
- **Cumulative burn map**: Number of times each pixel burned during the simulation..

## Saving

- **burnMap**: A RasterLayer describing how which pixels burned this timestep.
- **burnMapCumul**: A RasterLayer describing how many times each pixel burned over the course of the simulation.


# Data dependencies

```{r moduleInputs, echo = FALSE, eval = TRUE}
df_inputs <- SpaDES.core::moduleInputs("fireSense", "..")
knitr::kable(df_inputs)
```

## Output data

Description of the module outputs.

```{r moduleOutputs, echo = FALSE, eval = TRUE}
df_outputs <- SpaDES.core::moduleOutputs("fireSense", "..")
knitr::kable(df_outputs)
```

# Links to other modules

This module should be coupled with a dynamic vegetation model.

